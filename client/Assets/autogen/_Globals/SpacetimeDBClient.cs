// THIS FILE IS AUTOMATICALLY GENERATED BY SPACETIMEDB. EDITS TO THIS FILE
// WILL NOT BE SAVED. MODIFY TABLES IN RUST INSTEAD.
// <auto-generated />

#nullable enable

using System;
using SpacetimeDB;
using SpacetimeDB.ClientApi;
using System.Collections.Generic;

namespace SpacetimeDB.Types
{
	public sealed class RemoteTables
	{
		public class CircleHandle : RemoteTableHandle<EventContext, Circle>
		{

			public override void InternalInvokeValueInserted(IDatabaseRow row)
			{
				var value = (Circle)row;
				EntityId.Cache[value.EntityId] = value;
			}

			public override void InternalInvokeValueDeleted(IDatabaseRow row)
			{
				EntityId.Cache.Remove(((Circle)row).EntityId);
			}

			public class EntityIdUniqueIndex
			{
				internal readonly Dictionary<uint, Circle> Cache = new(16);
				public Circle? Find(uint value)
				{
					Cache.TryGetValue(value, out var r);
					return r;
				}

			}

			public EntityIdUniqueIndex EntityId = new();

			internal CircleHandle()
			{
			}
			public override object GetPrimaryKey(IDatabaseRow row) => ((Circle)row).EntityId;

		}

		public readonly CircleHandle Circle = new();

		public class ConfigHandle : RemoteTableHandle<EventContext, Config>
		{

			public override void InternalInvokeValueInserted(IDatabaseRow row)
			{
				var value = (Config)row;
				Id.Cache[value.Id] = value;
			}

			public override void InternalInvokeValueDeleted(IDatabaseRow row)
			{
				Id.Cache.Remove(((Config)row).Id);
			}

			public class IdUniqueIndex
			{
				internal readonly Dictionary<uint, Config> Cache = new(16);
				public Config? Find(uint value)
				{
					Cache.TryGetValue(value, out var r);
					return r;
				}

			}

			public IdUniqueIndex Id = new();

			internal ConfigHandle()
			{
			}
			public override object GetPrimaryKey(IDatabaseRow row) => ((Config)row).Id;

		}

		public readonly ConfigHandle Config = new();

		public class EntityHandle : RemoteTableHandle<EventContext, Entity>
		{

			public override void InternalInvokeValueInserted(IDatabaseRow row)
			{
				var value = (Entity)row;
				Id.Cache[value.Id] = value;
			}

			public override void InternalInvokeValueDeleted(IDatabaseRow row)
			{
				Id.Cache.Remove(((Entity)row).Id);
			}

			public class IdUniqueIndex
			{
				internal readonly Dictionary<uint, Entity> Cache = new(16);
				public Entity? Find(uint value)
				{
					Cache.TryGetValue(value, out var r);
					return r;
				}

			}

			public IdUniqueIndex Id = new();

			internal EntityHandle()
			{
			}
			public override object GetPrimaryKey(IDatabaseRow row) => ((Entity)row).Id;

		}

		public readonly EntityHandle Entity = new();

		public class MoveAllPlayersTimerHandle : RemoteTableHandle<EventContext, MoveAllPlayersTimer>
		{

			public override void InternalInvokeValueInserted(IDatabaseRow row)
			{
				var value = (MoveAllPlayersTimer)row;
				ScheduledId.Cache[value.ScheduledId] = value;
			}

			public override void InternalInvokeValueDeleted(IDatabaseRow row)
			{
				ScheduledId.Cache.Remove(((MoveAllPlayersTimer)row).ScheduledId);
			}

			public class ScheduledIdUniqueIndex
			{
				internal readonly Dictionary<ulong, MoveAllPlayersTimer> Cache = new(16);
				public MoveAllPlayersTimer? Find(ulong value)
				{
					Cache.TryGetValue(value, out var r);
					return r;
				}

			}

			public ScheduledIdUniqueIndex ScheduledId = new();

			internal MoveAllPlayersTimerHandle()
			{
			}
			public override object GetPrimaryKey(IDatabaseRow row) => ((MoveAllPlayersTimer)row).ScheduledId;

		}

		public readonly MoveAllPlayersTimerHandle MoveAllPlayersTimer = new();

	}

	public sealed class RemoteReducers : RemoteBase<DbConnection>
	{
		internal RemoteReducers(DbConnection conn, SetReducerFlags SetReducerFlags) : base(conn) { this.SetCallReducerFlags = SetReducerFlags; }
		internal readonly SetReducerFlags SetCallReducerFlags;
		public delegate void MoveAllPlayersHandler(EventContext ctx, SpacetimeDB.Types.MoveAllPlayersTimer timer);
		public event MoveAllPlayersHandler? OnMoveAllPlayers;

		public void MoveAllPlayers(SpacetimeDB.Types.MoveAllPlayersTimer timer)
		{
			conn.InternalCallReducer(new MoveAllPlayers { Timer = timer }, this.SetCallReducerFlags.MoveAllPlayersFlags);
		}

		public bool InvokeMoveAllPlayers(EventContext ctx, MoveAllPlayers args)
		{
			if (OnMoveAllPlayers == null) return false;
			OnMoveAllPlayers(
				ctx,
				args.Timer
			);
			return true;
		}
	}

	public sealed class SetReducerFlags
	{
		internal SetReducerFlags() { }
		internal CallReducerFlags MoveAllPlayersFlags;
		public void MoveAllPlayers(CallReducerFlags flags) { this.MoveAllPlayersFlags = flags; }
	}

	public partial record EventContext : DbContext<RemoteTables>, IEventContext
	{
		public readonly RemoteReducers Reducers;
		public readonly SetReducerFlags SetReducerFlags;
		public readonly Event<Reducer> Event;

		internal EventContext(DbConnection conn, Event<Reducer> reducerEvent) : base(conn.Db)
		{
			Reducers = conn.Reducers;
			SetReducerFlags = conn.SetReducerFlags;
			Event = reducerEvent;
		}
	}

	[Type]
	public partial record Reducer : TaggedEnum<(
		MoveAllPlayers MoveAllPlayers,
		Unit StdbNone,
		Unit StdbIdentityConnected,
		Unit StdbIdentityDisconnected
	)>;
	public class DbConnection : DbConnectionBase<DbConnection, Reducer>
	{
		public readonly RemoteTables Db = new();
		public readonly RemoteReducers Reducers;
		public readonly SetReducerFlags SetReducerFlags;

		public DbConnection()
		{
			SetReducerFlags = new();
			Reducers = new(this, this.SetReducerFlags);

			clientDB.AddTable<Circle>("circle", Db.Circle);
			clientDB.AddTable<Config>("config", Db.Config);
			clientDB.AddTable<Entity>("entity", Db.Entity);
			clientDB.AddTable<MoveAllPlayersTimer>("move_all_players_timer", Db.MoveAllPlayersTimer);
		}

		protected override Reducer ToReducer(TransactionUpdate update)
		{
			var encodedArgs = update.ReducerCall.Args;
			return update.ReducerCall.ReducerName switch {
				"move_all_players" => new Reducer.MoveAllPlayers(BSATNHelpers.Decode<MoveAllPlayers>(encodedArgs)),
				"<none>" => new Reducer.StdbNone(default),
				"__identity_connected__" => new Reducer.StdbIdentityConnected(default),
				"__identity_disconnected__" => new Reducer.StdbIdentityDisconnected(default),
				"" => new Reducer.StdbNone(default),
				var reducer => throw new ArgumentOutOfRangeException("Reducer", $"Unknown reducer {reducer}")
			};
		}

		protected override IEventContext ToEventContext(Event<Reducer> reducerEvent) =>
		new EventContext(this, reducerEvent);

		protected override bool Dispatch(IEventContext context, Reducer reducer)
		{
			var eventContext = (EventContext)context;
			return reducer switch {
				Reducer.MoveAllPlayers(var args) => Reducers.InvokeMoveAllPlayers(eventContext, args),
				Reducer.StdbNone or
				Reducer.StdbIdentityConnected or
				Reducer.StdbIdentityDisconnected => true,
				_ => throw new ArgumentOutOfRangeException("Reducer", $"Unknown reducer {reducer}")
			};
		}

		public SubscriptionBuilder<EventContext> SubscriptionBuilder() => new(this);
	}
}
